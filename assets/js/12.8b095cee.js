(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{352:function(t,a,s){"use strict";s.r(a);var e=s(42),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"弹幕源-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#弹幕源-api"}},[t._v("#")]),t._v(" 弹幕源 API")]),t._v(" "),s("p",[t._v("danmaqua-telegrambot 2.x 已经开始将弹幕 API 的连接部分分离。")]),t._v(" "),s("p",[t._v("要为 Bot 提供直播弹幕数据，你需要建立一个 WebSocket 服务器，在你的服务器中实现对直播平台的弹幕连接，将直播平台返回的弹幕数据以统一的数据格式向客户端（Bot）提供。")]),t._v(" "),s("p",[t._v("要让 Bot 支持新的弹幕源，你需要修改项目目录的 "),s("code",[t._v("bot.config.js")]),t._v(" 中的 "),s("code",[t._v("danmakuSources")]),t._v(" 字段，提供新的弹幕源描述和连接地址。")]),t._v(" "),s("p",[t._v("目前我们已经实现了哔哩哔哩和斗鱼直播平台的弹幕源，并提供了默认配置，你可以开箱即用。")]),t._v(" "),s("p",[t._v("客户端参考实现："),s("a",{attrs:{href:"https://github.com/danmaqua/danmaqua-telegrambot/blob/master/bot/api.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("bot/api.js"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("服务端参考实现："),s("a",{attrs:{href:"https://github.com/danmaqua/danmaqua-telegrambot/blob/master/dmsrc/common/index.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("dmsrc/common/index.js"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"websocket-消息类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#websocket-消息类型"}},[t._v("#")]),t._v(" WebSocket 消息类型")]),t._v(" "),s("h3",{attrs:{id:"join-room"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#join-room"}},[t._v("#")]),t._v(" "),s("code",[t._v("join_room")])]),t._v(" "),s("p",[t._v("客户端需要加入房间时可以发送 "),s("code",[t._v("join_room")]),t._v(" 消息，加入房间后，就可以开始接收这个房间内的弹幕消息。")]),t._v(" "),s("p",[t._v("参数："),s("code",[t._v("string")]),t._v("/"),s("code",[t._v("number")]),t._v(" 类型 - 房间号")]),t._v(" "),s("h3",{attrs:{id:"leave-room"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#leave-room"}},[t._v("#")]),t._v(" "),s("code",[t._v("leave_room")])]),t._v(" "),s("p",[t._v("客户端需要离开房间时可以发送 "),s("code",[t._v("leave_room")]),t._v(" 消息。")]),t._v(" "),s("p",[t._v("参数："),s("code",[t._v("string")]),t._v("/"),s("code",[t._v("number")]),t._v(" 类型 - 房间号")]),t._v(" "),s("h3",{attrs:{id:"reconnect-room"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reconnect-room"}},[t._v("#")]),t._v(" "),s("code",[t._v("reconnect_room")])]),t._v(" "),s("p",[t._v("客户端需要手动请求重新连接房间时可以发送 "),s("code",[t._v("reconnect_room")]),t._v(" 消息。")]),t._v(" "),s("p",[t._v("参数："),s("code",[t._v("string")]),t._v("/"),s("code",[t._v("number")]),t._v(" 类型 - 房间号")]),t._v(" "),s("h3",{attrs:{id:"danmaku"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#danmaku"}},[t._v("#")]),t._v(" "),s("code",[t._v("danmaku")])]),t._v(" "),s("p",[t._v("服务端获取到的弹幕会以 "),s("code",[t._v("danmaku")]),t._v(" 消息通知客户端。")]),t._v(" "),s("p",[t._v("参数："),s("a",{attrs:{href:"#%E6%A0%87%E5%87%86%E5%BC%B9%E5%B9%95%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"}},[s("code",[t._v("Danmaku")])]),t._v(" 类型 - 标准弹幕数据")]),t._v(" "),s("h2",{attrs:{id:"标准弹幕数据格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#标准弹幕数据格式"}},[t._v("#")]),t._v(" 标准弹幕数据格式")]),t._v(" "),s("p",[t._v("弹幕源 WebSocket 服务端返回的弹幕数据使用 JSON 序列化为文本。")]),t._v(" "),s("p",[t._v("数据格式样例：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sender"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uid"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4432261")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"username"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Siubeng"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"url"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://space.bilibili.com/4432261"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"text"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"233"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"time"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1594349332324")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"roomId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14917277")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);